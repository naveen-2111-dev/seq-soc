openapi: 3.0.3
info:
  title: Anony API
  version: 1.0.0
  description: A simple social media api, created with expressjs, sql and sequelize ORM
  contact:
    name: GitHub Repository
    url: https://github.com/naveen-2111-dev/seq-soc
servers:
  - url: http://localhost:8080
tags:
  - name: Auth
    description: Login and registration
  - name: Posts
    description: Post management and feed
  - name: Comments
    description: Comment operations
  - name: Follow
    description: Follow and unfollow users
  - name: Like
    description: Like and unlike posts
  - name: Save
    description: Save and unsave posts
  - name: Profile
    description: User profile operations
  - name: Upload
    description: Media upload
security:
  - accessTokenCookie: []
paths:
  /api/auth/login:
    post:
      tags:
        - Auth
      summary: Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Missing email or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/auth/register:
    post:
      tags:
        - Auth
      summary: Register
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: User registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/auth/me:
    get:
      tags:
        - Auth
      summary: Get current user from access token
      responses:
        '200':
          description: User authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/refresh:
    post:
      tags:
        - Auth
      summary: Refresh access token
      security:
        - refreshTokenCookie: []
      responses:
        '200':
          description: Access token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
        '401':
          description: No refresh token found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/create:
    post:
      tags:
        - Posts
      summary: Create a post
      description: Create a new post with content and optional image URL
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: The content of the post
                imageUrl:
                  type: string
                  nullable: true
                  description: Optional image URL for the post
      responses:
        '200':
          description: Post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '400':
          description: Missing required fields or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/update/{postId}:
    put:
      tags:
        - Posts
      summary: Update a post  
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostUpdateRequest'
      responses:
        '200':
          description: Post updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/visibility/{postId}:
    patch:
      tags:
        - Posts
      summary: Change post visibility
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VisibilityUpdateRequest'
      responses:
        '200':
          description: Visibility updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/upvote/{postId}:
    patch:
      tags:
        - Posts
      summary: Upvote a post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        '200':
          description: Vote updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/downvote/{postId}:
    patch:
      tags:
        - Posts
      summary: Downvote a post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        '200':
          description: Vote updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/all:
    get:
      tags:
        - Posts
      summary: Get all visible posts
      responses:
        '200':
          description: Posts fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/trending:
    get:
      tags:
        - Posts
      summary: Get trending posts
      responses:
        '200':
          description: Trending posts fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostWithAuthorArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/visibility/{visibility}:
    get:
      tags:
        - Posts
      summary: Get posts by visibility
      parameters:
        - name: visibility
          in: path
          required: true
          schema:
            type: boolean
      responses:
        '200':
          description: Posts fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts:
    get:
      tags:
        - Posts
      summary: Get posts for the authenticated user
      responses:
        '200':
          description: Posts fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostArrayResponse'
        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/posts/{postId}:
    get:
      tags:
        - Posts
      summary: Get a post by id
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Post fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/upload:
    post:
      tags:
        - Upload
      summary: Upload a media file
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: No file uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadErrorResponse'
        '500':
          description: Upload failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadErrorResponse'
  /api/comments/{postId}:
    post:
      tags:
        - Comments
      summary: Add a comment to a post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreateRequest'
      responses:
        '200':
          description: Comment added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/comments/getpostwithcomment:
    get:
      tags:
        - Comments
      summary: Get posts with comments (raw join)
      responses:
        '200':
          description: Post with comments fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostWithCommentRowArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/comments/post/{postId}:
    get:
      tags:
        - Comments
      summary: Get comments for a post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comments fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/comments/{commentId}:
    get:
      tags:
        - Comments
      summary: Get a comment by id
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comment fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/follow/follow:
    post:
      tags:
        - Follow
      summary: Follow a user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FollowRequest'
      responses:
        '200':
          description: Follow created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/follow/unfollow:
    delete:
      tags:
        - Follow
      summary: Unfollow a user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FollowRequest'
      responses:
        '200':
          description: Follow removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnfollowResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/follow/followers:
    get:
      tags:
        - Follow
      summary: Get followers for the authenticated user
      responses:
        '200':
          description: Followers fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/follow/following:
    get:
      tags:
        - Follow
      summary: Get following for the authenticated user
      responses:
        '200':
          description: Following fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowArrayResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/like/like:
    post:
      tags:
        - Like
      summary: Like a post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LikeRequest'
      responses:
        '200':
          description: Post liked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          description: User ID and Post ID are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/like/unlike:
    delete:
      tags:
        - Like
      summary: Unlike a post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LikeRequest'
      responses:
        '200':
          description: Post unliked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          description: User ID and Post ID are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/save/save:
    post:
      tags:
        - Save
      summary: Save a post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveRequest'
      responses:
        '200':
          description: Post saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveResponse'
        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/save/unsave:
    delete:
      tags:
        - Save
      summary: Unsave a post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveRequest'
      responses:
        '200':
          description: Post unsaved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Saved post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/save/user:
    get:
      tags:
        - Save
      summary: Get saved posts for the authenticated user
      responses:
        '200':
          description: Saved posts fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SavedPostArrayResponse'
        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/profile:
    put:
      tags:
        - Profile
      summary: Update profile image
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileUpdateRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '400':
          description: Missing profile image URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      tags:
        - Profile
      summary: Get profile for current user
      responses:
        '200':
          description: Profile fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '400':
          description: Missing email in token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    accessTokenCookie:
      type: apiKey
      in: cookie
      name: accessToken
    refreshTokenCookie:
      type: apiKey
      in: cookie
      name: refreshToken
  schemas:
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
    RegisterRequest:
      type: object
      required:
        - firstname
        - lastname
        - email
        - password
      properties:
        firstname:
          type: string
        lastname:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
    PostCreateRequest:
      type: object
      required:
        - content
        - userId
      properties:
        content:
          type: string
        imageUrl:
          type: string
          nullable: true
        userId:
          type: integer
    PostUpdateRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
        imageUrl:
          type: string
          nullable: true
    VisibilityUpdateRequest:
      type: object
      required:
        - visibility
      properties:
        visibility:
          type: boolean
    VoteRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - cr
            - rm
    CommentCreateRequest:
      type: object
      required:
        - content
        - userId
      properties:
        content:
          type: string
        userId:
          type: integer
    FollowRequest:
      type: object
      required:
        - followingId
      properties:
        followingId:
          type: integer
    LikeRequest:
      type: object
      required:
        - postId
      properties:
        postId:
          type: integer
    SaveRequest:
      type: object
      required:
        - postId
      properties:
        postId:
          type: integer
    ProfileUpdateRequest:
      type: object
      required:
        - profileImageUrl
      properties:
        profileImageUrl:
          type: string
    User:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        passwordHash:
          type: string
        profileImage:
          type: string
        fullName:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    UserPublic:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        fullName:
          type: string
        profileImage:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Follow:
      type: object
      properties:
        id:
          type: integer
        followerId:
          type: integer
        followingId:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    SavePost:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
          readonly: true
        postId:
          type: integer
        User:
          $ref: '#/components/schemas/UserPublic'
        Post:
          $ref: '#/components/schemas/Post'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Post:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
          readonly: true
        content:
          type: string
        imageUrl:
          type: string
          nullable: true
        visibility:
          type: boolean
        upVotes:
          type: integer
        downVotes:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PostWithAuthor:
      allOf:
        - $ref: '#/components/schemas/Post'
        - type: object
          properties:
            author:
              $ref: '#/components/schemas/UserPublic'
    Comment:
      type: object
      properties:
        id:
          type: integer
        postId:
          type: integer
        userId:
          type: integer
          nullable: true
        content:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PostWithCommentRow:
      type: object
      additionalProperties: true
      description: Raw row from posts to comments join
    BaseResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            error:
              type: object
              additionalProperties: true
    AuthTokenPayload:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        iat:
          type: integer
        exp:
          type: integer
    LoginUser:
      type: object
      properties:
        safeUser:
          $ref: '#/components/schemas/UserPublic'
        accessToken:
          type: string
        refreshToken:
          type: string
    LoginResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            user:
              $ref: '#/components/schemas/LoginUser'
    MeResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            user:
              $ref: '#/components/schemas/AuthTokenPayload'
    RefreshResponse:
      type: object
      properties:
        message:
          type: string
    RegisterResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
    PostResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Post'
    PostArrayResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Post'
    PostWithAuthorArrayResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/PostWithAuthor'
    CommentResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Comment'
    CommentArrayResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Comment'
    PostWithCommentRowArrayResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/PostWithCommentRow'
    FollowResponse:
      type: object
      properties:
        id:
          type: integer
        followerId:
          type: integer
        followingId:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    FollowArrayResponse:
      type: array
      items:
        $ref: '#/components/schemas/Follow'
    UnfollowResponse:
      type: integer
      description: Number of rows deleted
    SaveResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/SavePost'
    SavedPostArrayResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/SavePost'
    ProfileResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/User'
    UploadResponse:
      type: object
      properties:
        success:
          type: boolean
        url:
          type: string
      required:
        - success
        - url
    UploadErrorResponse:
      type: object
      properties:
        error:
          type: string
      required:
        - error
